
(function(f){f.fn.jqm=function(n){return this.each(function(){var q=f(this),p=q.data("jqm")||f.extend({ID:j++},f.jqm.params),r=f.extend(p,n);q.data("jqm",r).addClass("jqm-init");r.trigger&&q.jqmAddTrigger(r.trigger)})};f.fn.jqmAddTrigger=function(n){return this.each(function(){if(!a(f(this),"jqmShow",n)){d("jqmAddTrigger must be called on initialized modals")}})};f.fn.jqmAddClose=function(n){return this.each(function(){if(!a(f(this),"jqmHide",n)){d("jqmAddClose must be called on initialized modals")}})};f.fn.jqmShow=function(n){return this.each(function(){!this._jqmShown&&k(f(this),n)})};f.fn.jqmHide=function(n){return this.each(function(){this._jqmShown&&h(f(this),n)})};var d=function(n){if(window.console&&window.console.error){window.console.error(n)}},k=function(u,q){var x=u.data("jqm"),q=q||window.event,w=(parseInt(u.css("z-index"))),w=(w>0)?w:10001,n=f("<div></div>").addClass(x.overlayClass).css({display:"none",height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":w-1,opacity:x.overlay/100}),r={w:u,c:x,o:n,t:q};u.css("z-index",w);if(x.ajax){var s=x.target||u,p=x.ajax;s=(typeof s=="string")?f(s,u):f(s);if(p.substr(0,1)=="@"){p=f(q).attr(p.substring(1))}s.html(x.ajaxText).load(p,function(){x.onLoad&&x.onLoad.call(this,r);g(r)})}else{g(r)}},h=function(q,n){var r=q.data("jqm"),n=n||window.event,p={w:q,c:r,o:q.data("jqmv"),t:n};m(p)},i=function(n){if(n.c.overlay>0){n.o.prependTo("body").fadeIn(n.c.fade)}n.w.fadeIn(n.c.fade);f.jqm.focusFunc(n.w);return true},e=function(n){n.w.fadeOut(n.c.fade)&&n.o&&n.o.fadeOut(n.c.fade,function(){n.o.remove()});return true},a=function(q,p,o){var n=q.data("jqm");if(!q.data("jqm")){return false}return f(o).each(function(){this[p]=this[p]||[];if(f.inArray(n.ID,this[p])<0){this[p].push(n.ID);f(this).click(function(){var r=this;q[p](this);return false})}})},g=function(p){var q=p.w,n=p.o,r=p.c;if(r.onShow(p)!==false){q[0]._jqmShown=true;if(r.modal){!b[0]&&l("bind");b.push(q)}else{q.jqmAddClose(n)}r.closeClass&&q.jqmAddClose(f("."+r.closeClass,q));r.toTop&&n&&q.before('<span id="jqmP'+r.ID+'"></span>').insertAfter(n);q.data("jqmv",n);q.unbind("keydown",f.jqm.closeOnEscFunc);if(r.closeOnEsc){q.attr("tabindex",0).bind("keydown",f.jqm.closeOnEscFunc).focus()}}},m=function(p){var q=p.w,n=p.o,r=p.c;if(r.onHide(p)!==false){q[0]._jqmShown=false;if(r.modal){b.pop();!b[0]&&l("unbind")}r.toTop&&n&&f("#jqmP"+r.ID).after(q).remove()}},l=function(n){f(document)[n]("keypress keydown mousedown",c)},c=function(p){var o=f(p.target).data("jqm")||f(p.target).parents(".jqm-init:first").data("jqm"),n=b[b.length-1].data("jqm");if(o&&o.ID==n.ID){return true}return f.jqm.focusFunc(n)},j=0,b=[];f.jqm={params:{overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",closeOnEsc:false,trigger:".jqModal",ajax:false,target:false,ajaxText:"",modal:false,toTop:false,onShow:i,onHide:e,onLoad:false,fade:200},focusFunc:function(n){f(":input:visible:first",n).focus();return false},closeOnEscFunc:function(n){if(n.keyCode==27){f(this).jqmHide();return false}}}})(jQuery);