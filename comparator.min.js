
var selected=new Array();var photos=new Array();var urlComp="/comparator.jsp";$(document).ready(function(){$(".comparation input[type=checkbox]").click(function(){var a=$(this).attr("id").substring(4);if($(this).is(":checked")){if(selected.length==4){alert(maxCompTxt);$(this).attr("checked",false)}else{addItem(a)}}else{deleteItem(a)}})});function compare(a){if(selected.length<=1){alert(minCompTxt)}else{Events.addDLEvent("interaccion","comparar","click","");getUrl($("#"+a).find('input[id="cod_template"]').val());$("#"+a+"").attr("action",urlComp);$("#"+a).submit()}}function showCompareBtn(a){$("#chk_"+a).attr("checked",true);$(".comparation #chk_"+a).parents(".producto").toggleClass("to-compare")}function addItem(c){selected.push(c);var a="<a href='"+$("#foto_"+c).attr("href")+"' target='_blank'>"+$("#foto_"+c).html()+"<p>"+$("#foto_"+c).attr("data-compTit")+"</p></a>";photos.push(a);var b="<div id='item_"+c+"' class='col'>"+a+"<a href='javascript:deleteItem(\""+c+"\");'";b+=" class='boton link-icon del'>"+delTxt+"</a></div>";if($("#compare-layer .col:last-child").length==0){$(b).insertBefore("#compare-layer .botonera")}else{$(b).insertAfter("#compare-layer .col:last-child")}if(selected.length==1){$("#compare-overlay").slideDown(300,function(){$("#compare-layer #item_"+c).fadeIn(500)})}else{$("#compare-layer #item_"+c).fadeIn(500)}$("#selected-number").html(selected.length+" ");showCompareBtn(c);setData(codTemplate)}function deleteItem(b){var a=selected.indexOf(b);if(a!=-1){selected.splice(a,1);photos.splice(a,1)}if(selected.length<=0){$("#compare-layer #item_"+b).fadeOut(400,function(){$("#compare-overlay").slideUp(300,function(){$("#compare-layer #item_"+b).remove()})})}else{$("#compare-layer #item_"+b).fadeOut(400,function(){$("#compare-layer #item_"+b).remove()})}$("#chk_"+b).attr("checked",false);$(".comparation #chk_"+b).parents(".producto").toggleClass("to-compare");$(".comparation label#btn_"+b).unbind("click");$("#selected-number").html(selected.length+" ");setData(codTemplate)}function clearAll(){var a=selected;$.each(a,function(){var b=this;$("#compare-layer #item_"+b).fadeOut(400,function(){$("#compare-layer #item_"+b).remove()});$("#chk_"+b).attr("checked",false);$(".comparation #chk_"+b).parents(".producto").toggleClass("to-compare")});$("#compare-overlay").slideUp(300);selected=[];photos=[];reset(codTemplate);$("#selected-number").html(selected.length+" ")}function showSelected(){var b="",c="",a="";$(".comparation input[type=checkbox]").attr("disabled",false);if(selected.length>0){$("#compare-overlay").slideDown(300,function(){$.each(selected,function(d){c=this;a=photos[d];b="<div id='item_"+c+"' class='col'>"+a+"<a href='javascript:deleteItem(\""+c+"\");'";b+=" class='boton link-icon del'>"+delTxt+"</a></div>";if($("#compare-layer .col:last-child").length==0){$(b).insertBefore("#compare-layer .botonera")}else{$(b).insertAfter("#compare-layer .col:last-child")}$("#compare-layer #item_"+c).fadeIn(500);showCompareBtn(c)})})}$("#selected-number").html(selected.length+" ")}$(window).load(function(){if(codTemplate!=0){showSelected()}});function getData(a){var c=Math.floor((Math.random()*100000)+1);var b="/ComparatorServlet?accion=get_selected&id="+a+"&r="+c;$.ajax({url:b,async:false,dataType:"html",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){try{var f=jQuery.parseJSON(e);if(f.selected!=""){selected=f.selected.split(",")}if(f.photos!=""){photos=f.photos.split("|")}}catch(d){throw new Error("CGD: "+d.message)}},error:function(d){throw new Error("CGD: "+d.message)}})}function setData(a){var c=Math.floor((Math.random()*100000)+1);var b="/ComparatorServlet?accion=set_selected&id="+a+"&selected="+selected+"&r="+c;$.ajax({url:b,async:true,dataType:"html",data:{photos:photos.join("|")},contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){},error:function(d){throw new Error("CSD: "+d.message)}})}function reset(a){var c=Math.floor((Math.random()*100000)+1);var b="/ComparatorServlet?accion=reset&id="+a+"&r="+c;$.ajax({url:b,async:true,dataType:"html",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(d){},error:function(d){throw new Error("CR: "+d.message)}})}function getUrl(a){var c=Math.floor((Math.random()*100000)+1);var b="/ComparatorServlet?accion=get_url&id="+a+"&r="+c;$.ajax({url:b,async:false,dataType:"html",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(e){try{var f=jQuery.parseJSON(e);if(f.url!=""){urlComp=f.url}}catch(d){throw new Error("CGU: "+d.message)}},error:function(d){throw new Error("CGU: "+d.message)}})};