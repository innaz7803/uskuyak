
var Checkout=(function(){var b=$(window),u="#bg",g=$(u).width()/$(u).height();var d="1";var E="/CheckoutServlet";var M="/OrderServlet";var c="/AdyenOrderServlet";var H="/ETransactionsOrderServlet";var K="/CustomerAreaServlet";var J="";var o=false;var h="shipeddir";var f="shipseldir";function B(O){if(!o){$("#breadcrumb .step").prepend('<i class="icon"></i>');o=true}var N=$(O).validate({errorElement:"div",errorClass:"form-validation error",rules:{password:{required:true,rangelength:[4,15]},passwordhdn:{required:true,rangelength:[4,15]},email:{required:true,email:true,rangelength:[5,80]},pr_email:{required:true,email:true,rangelength:[5,80]},nombre:{required:true,rangelength:[1,60],specialchars:true},apellidos:{required:true,rangelength:[1,60],specialchars:true},empresa:{required:true,rangelength:[1,80],specialchars:true},cif_nif:{cifnif:true,rangelength:[1,30]},telefono1:{required:true,phone:true,rangelength:[1,16]},direccion:{required:true,specialchars:true,minlength:5},cp:{required:true},poblacion:{required:true,rangelength:[1,30],specialchars:true},chk_cg:{cgaccept:true},g_radio:{required:true},password_act:{required:true},r_password:{required:true,equalTo:"#password"},fp_rdb:{fpVal:true},comentarios_envio:{required:true,rangelength:[1,100],specialchars:true},coupon_ref:{rangelength:[1,30]}},errorPlacement:function(P,Q){if(Q.attr("name")==="fp_rdb"){P.insertAfter($("#fp_options"))}else{if(Q.attr("name")==="password"||Q.attr("name")==="passwordhdn"){P.insertAfter($("#pass_wrap"))}else{if(Q.attr("name")==="chk_cg"){P.insertAfter($("#condiciones-legales"))}else{P.insertAfter(Q);if(Q.attr("name")==="comentarios_envio"){P.css("margin-left","0px")}}}}},invalidHandler:function(Q,P){if(!P.numberOfInvalids()){return}$("html, body").animate({scrollTop:$(P.errorList[0].element).offset().top-100},500)}});$.validator.addMethod("dirTotal",function(R,P){var Q=$("#direccion2").val().length+$("#direccion").val().length<79;if(Q){if($("#direccion").val().length>=5){$("#direccion").attr("class","form-box valid")}$("#direccion2").attr("class","form-box valid")}else{$("#direccion").attr("class","form-box error");$("#direccion2").attr("class","form-box error")}if(P.id=="direccion"){$("#direccion2-error").css("display","none")}else{if($("#direccion").val().length>=5){$("#direccion-error").css("display","none")}}return Q},jQuery.validator.messages.dirTotal);$(".cancel").click(function(){if(typeof(N)!=="undefined"){N.cancelSubmit=true}});$("a.back").click(function(){parent.history.back();return false});$(".radio").click(function(){$("input:not(:checked)").parent().removeClass("active");$("input:checked").parent().addClass("active")});$(".modal-dialog #expand-modal").click(function(){if($(".modal-dialog .modal-body").is(":visible")){$(".modal-dialog #expand-modal").text("+")}else{$(".modal-dialog #expand-modal").text("-")}$(".modal-dialog .modal-body").toggleClass("hide")})}function y(N,O,P){if((N.width()/N.height())<O){$(P).removeClass().addClass("bgheight")}else{$(P).removeClass().addClass("bgwidth")}}function p(){$(".mypass").click(function(){$("#pass_reminder_lc").fadeIn();$("#sign-in").hide();$("#pr_email").val($("#email").val())});$("#btn_remind_back").click(function(){$("#pass_reminder_lc").hide();$("#sign-in").fadeIn()});$("#link-sign-up").click(function(){$("#pass_reminder_lc").hide();$(".alert-mssg").css("display","none")});$("#link-sign-in").click(function(){$("#pass_reminder_lc").hide();$("#sign-in").fadeIn();$(".alert-mssg").css("display","none")});if(window.location.hash){var O=window.location.hash.substring(1);if(O=="showpass"){$("#pass_reminder_lc").fadeIn();$("#sign-in").hide()}}$("#f_chk_l input[id=password]").on("blur",function(){$("#f_chk_l input[id=passwordhdn]").val($(this).val())});$("#f_chk_l input[id=passwordhdn]").on("blur",function(){$("#f_chk_l input[id=password]").val($(this).val())});$("#f_chk_l #buttonShow").on("click",function(){if($("#f_chk_l input[id=passwordhdn]").css("display")=="none"){$("#f_chk_l #buttonShow").html(hidePass);$("#f_chk_l input[id=password]").hide();$("#f_chk_l input[id=passwordhdn]").show()}else{$("#f_chk_l #buttonShow").html(showPass);$("#f_chk_l input[id=password]").show();$("#f_chk_l input[id=passwordhdn]").hide()}});$(".tabs-block").tabs();try{if(selectedTab!==""){$(".tabs-block").tabs("option","active",selectedTab)}else{$(".tabs-block").tabs("option","active",1)}}catch(N){console.error(err+" ERROR: tab index error");$(".tabs-block").tabs("option","active",1)}}function l(O,N){$(O+" input[id=a]").val(N);$(O+" input[id=st]").val(0);$(O).attr("action",E);FormUtils.submitFormPDS(O)}function G(O,N){if($(O).valid()){$(O+" input[id=a]").val(N);FormUtils.submitFormPDS(O)}}function C(O,N){if($(O).valid()){$(O+" input[id=a]").val(N);$(O+" input[id=st]").val(0);$(O).attr("action",E);FormUtils.submitFormPDS(O)}}function i(O,N){if($(O).valid()){$(O+" input[id=a]").val(N);$(O+" input[id=st]").val(0);$(O).attr("action",E);FormUtils.submitFormPDS(O)}}function D(Q,N){if($(Q).valid()){if(N=="rgstep1"){if(document.getElementById("chk_cg").checked){document.getElementById("consentimiento_rgpd").value="S"}else{document.getElementById("consentimiento_rgpd").value="N"}}var R=$("#cps option:selected").val();var O=$("#cpvs").val();$(Q+" input[id=cod_pais]").val(R);$(Q+" input[id=cod_provincia]").val(O);var P=$(Q+" input[id=cif_nif]").val();if(P!=""){P=clearCIFNIF(P)}$(Q+" input[id=cif_nif]").val(P);Events.seguimientoFormularios($(Q).attr("name"),"exito","");if(N!=""){$(Q+" input[id=a]").val(N)}$(Q+" input[id=st]").val(0);$(Q).attr("action",E);FormUtils.submitFormPDS(Q)}else{Events.seguimientoFormularios($(Q).attr("name"),"error",$(Q).validate().errorMap)}}function z(N,P,O){if(N==P){$(O).slideDown(830);$("#cif_nif").rules("add",{required:true})}else{$(O).slideUp(830);if(cifNifOptional){$("#cif_nif").rules("remove","required")}}}function F(P,R,Q,O,N){if(P==R){$(Q).text(O)}else{$(Q).text(N)}}function w(O,N,P){$.ajax({url:E+"?a=loadProv&grupo="+N+"&pais="+P,cache:true,timeout:20000,async:true,success:function(R){var Q=$("#cpvs option:selected").val();$("#cpvs").html(R);$('#cpvs option[value="'+Q+'"]').prop("selected",true)}})}function q(O){var N=$(O+" #cpvs option:selected").attr("mask");if(N!=null){$("#cp").rules("remove");$("#cp").rules("add",{required:true,postalcode:[N]})}}function n(N,P){$(N).validate().resetForm();$(".valid").removeClass("valid");var O=$(N+" input[id=cpais_"+P+"]").val();$(N+" input[id=ab_"+P+"]").prop("checked",true);$(N+" input[id=nombre]").val($(N+" input[id=nom_"+P+"]").val());$(N+" input[id=apellidos]").val($(N+" input[id=apel_"+P+"]").val());$(N+" input[id=telefono1]").val($(N+" input[id=tfn1_"+P+"]").val());$(N+" input[id=direccion]").val($(N+" input[id=dir_"+P+"]").val());$(N+" input[id=cp]").val($(N+" input[id=cp_"+P+"]").val());$(N+" input[id=poblacion]").val($(N+" input[id=pobl_"+P+"]").val());$('#cps option[value="'+O+'"]').prop("selected",true);$('#cpvs option[value="'+$(N+" input[id=cprov_"+P+"]").val()+'"]').prop("selected",true);q(N);if($(N+" input[id=a]").val()==newShipA){$(N+" input[id=direccion_ppal]").val(isAddrsMainN)}else{$(N+" input[id=direccion_ppal]").val($(N+" input[id=dppal_"+P+"]").val())}$(N+" input[id=cod_direccion]").val(P);w(N,0,$(N+" #cps").val())}function I(N){$(N+" input:radio[name=ab_radio]").attr("checked",false);if(!newacc){$("#personal").slideDown(830);$(".btnact").slideDown(830)}$(".addrst").text(newAddrT);$(".btnact").text(addAndGo);$(N+" input[id=a]").val(newShipA);$(N+" input[id=direccion2]").parent().css("display","block");$("html, body").animate({scrollTop:$("#personal").offset().top},1500);n(N,"")}function k(O,P,N){if(!newacc){if(N==h){$("#personal").slideDown(830)}else{$("#personal").slideUp(830)}$(".btnact").fadeIn(400)}$(".addrst").text(upAddrT);if(N==h){$(".btnact").text(upAndGo)}else{$(".btnact").text(selAndGo)}$(O+" input[id=a]").val(upShipA);$(O+" input[id=direccion2]").parent().css("display","none");if(N==h){$("html, body").animate({scrollTop:$("#personal").offset().top},1500)}n(O,P)}function j(N){if(newacc){$("#personal").slideDown(1)}z($(N+" input:radio[name=tc_radio]:checked").val(),ctEmp,".company");if(!showdoc&&!hidedoc){z($(N+" input:radio[name=tc_radio]:checked").val(),ctEmp,".docly")}F($(N+" input:radio[name=tc_radio]:checked").val(),ctEmp,".doc",dnicif,dninif);$(".address .botonera").prepend('<i class="icon-step-plus"></i>');$(".address .botonera").click(function(){window.location=$(this).find("a").attr("href");return false});$(N+" input:radio[name=tc_radio]").click(function(){var O=$(N+" input:radio[name=tc_radio]:checked");z(O.val(),ctEmp,".company");if(!showdoc&&!hidedoc){z($(N+" input:radio[name=tc_radio]:checked").val(),ctEmp,".docly")}F(O.val(),ctEmp,".doc",dnicif,dninif)});$(N+" input:radio[name=ab_radio]").click(function(){var O=$(N+" input:radio[name=ab_radio]:checked");n(N,O.val());$(N+" input[id=a]").val(selShipA);k(N,$(this).val(),f)});$(N+" div[id^='div_dir_']").click(function(){$(this).children().children(".radio").prop("checked",true);$(".label-radio").removeClass("active");$(this).children().addClass("active");var O=$(N+" input:radio[name=ab_radio]:checked");n(N,O.val());$(N+" input[id=a]").val(selShipA);k(N,O.val(),f)});q(N);$(N+" #cps").change(function(){w(N,0,$(this).val())});$("#cp").rules("add",{required:true,postalcode:true});if($("#email").length>0){$("#email").rules("add",{messages:{remote:function(){if($("#f_chk_s #ct").val()==""){emValMsg=emValMsg.replace("{0}","?");emValMsg=emValMsg.replace("{1}",$("#f_chk_s #email").val())}else{emValMsg=emValMsg.replace("{0}","?ct="+$("#f_chk_s #ct").val()+"&");emValMsg=emValMsg.replace("{1}",$("#f_chk_s #email").val())}return emValMsg}},remote:{url:E+"?a="+emValA,type:"post",data:{cod_grupo_clientes:function(){return $("#cod_grupo_clientes").val()}}}})}$("#direccion").rules("add","dirTotal");$("#direccion2").rules("add","dirTotal");if($("#password").length>0){$("#password").rules("remove","required");$("#passwordhdn").rules("remove","required")}$(N+" input[id=password]").on("blur",function(){$(N+" input[id=passwordhdn]").val($(this).val())});$(N+" input[id=passwordhdn]").on("blur",function(){$(N+" input[id=password]").val($(this).val())});$(N+" #buttonShow").on("click",function(){if($(N+"  input[id=passwordhdn]").css("display")=="none"){$(N+" #buttonShow").html(hidePass);$(N+" input[id=password]").hide();$(N+" input[id=passwordhdn]").show()}else{$(N+" #buttonShow").html(showPass);$(N+" input[id=password]").show();$(N+" input[id=passwordhdn]").hide()}});Events.seguimientoFormularios($(N).attr("name"),"acceso","")}function L(N){z($(N+" input[id=tc]").val(),ctEmp,".company");$(N+' #cps option[value="'+$(N+" input[id=cod_pais]").val()+'"]').prop("selected",true);$(N+' #cpvs option[value="'+$(N+" input[id=cod_provincia]").val()+'"]').prop("selected",true);q(N);$(N+" #cps").change(function(){w(N,0,$(this).val())});$("#cp").rules("add",{required:true,postalcode:true});$("#direccion").rules("add","dirTotal");$("#direccion2").rules("add","dirTotal");w(N,0,$(N+" #cps").val());Events.seguimientoFormularios($(N).attr("name"),"acceso","")}function v(N){$(N+" li[id^='li_']").click(function(){$("#fp_"+$(this).attr("fp")).prop("checked",true);var P=$(N+" input:radio[name=fp_rdb]:checked");var R=P.val();var U=$(N+" input[id=pass_"+P.val()+"]").val();var T=$(N+" input[id=btn_"+P.val()+"]").val();$(N+" input[id=cod_forma_pago]").val(P.val());$(N+" input[id=pasarela]").val(U);$(".chk").text(T);if(adyenPass==U){$(N).attr("action",c)}else{if(etransPass==U){$(N).attr("action",H)}else{$(N).attr("action",M)}}$(".label-radio").removeClass("active");$(this).children(".label-radio").toggleClass("active");$("#fp_rdb-error").css("display","none");$(N+" div[id^='fp_description_']").css("display","none");$(N+" div[id='fp_description_"+R+"']").css("display","block");if($(N+" #ncs_"+R+"").length){m(R)}try{var Q=$.grep(fpData,function(V){return V.fp==R})[0];if(typeof Q!="undefined"&&Q!=null){if(Q.factor==1&&Q.fixed==0){var O=$("#fp_charge").is(":visible");$("#fp_charge").fadeOut(function(){$("#imp_total .txt-right").html(Q.fp_total);$("#fp_charge .txt-right").html("");$("#fp_charge #fp_txt").html("");if(O){$("#imp_total").fadeOut().fadeIn().fadeOut().fadeIn()}})}else{$("#fp_charge").fadeIn(function(){$("#fp_charge .txt-right").html(Q.fixed_txt);$("#fp_charge #fp_txt").html(Q.fp_txt);$("#imp_total .txt-right").html(Q.fp_total);$("#imp_total, #fp_charge").fadeOut().fadeIn().fadeOut().fadeIn()})}}}catch(S){console.error(S+" ERROR: Can't get paymentmean extra data")}});$(".collapsable-hd").click(function(){if($(".collapsable-bd").is(":visible")){$(this).removeClass("expanded")}else{$(this).addClass("expanded");("-")}$(this).next().toggleClass("hide")})}function m(N){var O=$("#ncs_"+N+" option:selected").val();$("#n_cuenta").val(O)}function x(O){var N=$("#f_chk_t").validate({errorElement:"div",errorClass:"form-validation error",rules:{comentarios_envio:{rangelength:[1,100],specialchars:true}},errorPlacement:function(P,Q){if(Q.attr("name")==="fp_rdb"){P.insertBefore($("#fd_fieldset"))}else{if(Q.attr("name")==="password"||Q.attr("name")==="passwordhdn"){P.insertAfter($("#pass_wrap"))}else{P.insertAfter(Q);if(Q.attr("name")==="comentarios_envio"){P.css("margin-left","0px")}}}}});$("#comentarios_envio").focus(function(){$("#ajaxRes").html("")})}function s(O,N){if($(O).valid()){$(O+" input[id=a]").val(N);$.ajax({url:E+"?a="+N+"&comentarios_envio="+$("#comentarios_envio").val()+"&cod_pedido="+$("#cod_pedido").val(),cache:true,timeout:20000,async:true,beforeSend:function(P){P.setRequestHeader("Accept","text/html; charset=utf-8");$("#ajaxRes").html("<img src='/"+FD.tienda+"/checkout/images/ajax-loader.gif' style='margin-left:1em; height:15px;'/>")},success:function(P){setTimeout(function(){$("#ajaxRes").html("<img src='/"+FD.tienda+"/checkout/images/ajax-ok.png' style='margin-left:1em; height:15px;'/>")},2000)}})}}function e(O,N){if($(O).valid()){$(O+" input[id=a]").val(N);$.ajax({type:"POST",url:E,data:{a:N,password:$(O+" input[id=password]").val(),passwordhdn:$(O+" input[id=passwordhdn]").val(),email:$(O+" input[id=email]").val(),ajax:"ajax"},cache:false,timeout:20000,async:true,beforeSend:function(P){P.setRequestHeader("Accept","text/html; charset=utf-8");$("#changeBtn").replaceWith('<span id="ajaxResPwd"><img src=\'/'+FD.tienda+"/checkout/images/ajax-loader-big.gif' style='margin-right:1em; height:36px;'/></span>")},success:function(P){$("#ajaxResPwd").html("");$("#pass-generator").slideToggle().remove();$("#namsg").css("display","block");$("#namsgtxt").html(P);$("#gomya").fadeToggle()}})}}function a(N){if(N=="#f_chk_l"){$("#pass_reminder_lc").fadeIn()}else{$(N+" input[id=password]").on("blur",function(){$(N+" input[id=passwordhdn]").val($(this).val())});$(N+" input[id=passwordhdn]").on("blur",function(){$(N+" input[id=password]").val($(this).val())});$(N+" #buttonShow").on("click",function(){if($(N+" input[id=passwordhdn]").css("display")=="none"){$(N+" #buttonShow").html(hidePass);$(N+" input[id=password]").hide();$(N+" input[id=passwordhdn]").show()}else{$(N+" #buttonShow").html(showPass);$(N+" input[id=password]").show();$(N+" input[id=passwordhdn]").hide()}$(N).valid()})}}function r(O,N){if($(O).valid()){$(O+" input[id=a]").val(N);$(O).attr("action",E);FormUtils.submitFormPDS(O)}}function A(O,N){if($(O).valid()){$(O+" input[id=a]").val(N);$(O).attr("action",E);FormUtils.submitFormPDS(O)}}function t(O,N){$(O+" input[id=a]").val(N);$(O).attr("action",E);FormUtils.submitFormPDS(O)}return{onReadyChk:function(O,N){B(O);if(N==1){p()}if(N==2){j(O)}if(N==3){L(O)}if(N==4){v(O)}if(N==5){x(O)}if(N==6){a(O)}b.resize(y(b,g,u)).trigger("resize")},goStep:function(O,N){l(O,N)},login:function(O,N){C(O,N)},procUser:function(O,N){D(O,N)},passRemind:function(O,N){i(O,N)},passChange:function(O,N){r(O,N)},addNewAddrs:function(N){I(N)},editAddrs:function(O,P,N){k(O,P,N)},checkout:function(O,N){G(O,N)},saveComments:function(O,N){s(O,N)},passChangeThanks:function(O,N){e(O,N)},procCoupon:function(O,N){A(O,N)},couponReset:function(O,N){t(O,N)},setAccountNumber:function(N){m(N)},CT_SHIP_ED_DIR:h,CT_SHIP_SEL_DIR:f}})();